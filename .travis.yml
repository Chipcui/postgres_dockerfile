sudo: required
services:
  - docker

env:
  global:
    - IMAGE_NAME=breedbase/pg
    - secure: "ARfw/6JoQsmJdodqU1D9RLro+M998eUkYqvdzUPzZpdcPO44mNsrsjirbsnII7OCNe7bQvQOTHgYyHXEuPgOFQV5JGxvzl3j7UOJ1VE0mcaMKerj8FjqgjhFYv4agp01536e9EpH0t2wIn6m2yn5b0tYyTEHi/PbfmKlHY9GX77HvziRDAKeVR3LncNb69djph7Bl2c9YMLjCZJVRuPY1Zb8EoYAlu9lIyY2gWkJoaPz314+aJ6earH8mg/363mE8cDSBdn9jLanzLMxAiz+wvMLpDwem/VmjpIoe+lH0VgPadtW0tQOg7Gw8CUfWBtuphEi6hK/Or939Qzku41Q/yW8MZPkTea1hJuAQMAxczLh9BhDtmMV/f/RH7w9p9DRY9pw8QPNd3kZqgic631upbPgoG+OHJ4zNmWsIliDS4nMDVorkq38Lm8LiZBkMgVTZ97YIkm557IhIJp/3PASBL/vhtnFi+KLHjMhszz9q6qFeu2X37zbJEP+TFOPsGxZsTIx9BuQgTuFxhaR0aP3vkOdul32ieX6fuNaACxmP5B2K8XILKNErncWEiDN03wCRc2+c0pv+9lxXRQCuqCQeJ6zjf8PbfGGNzYwpSb73E2/C9B//bjxTK4rtiv5Auh5KrlPy9jMvhOJnpkfLqyFW1PNDOJe2g18k8DqIyPgjWU="
    - secure: "t+JexqOahnVlGBvkwOCwdorIYKi8PWP2qZeWhTkw/Q1p33xDYyFdE8u78LBsDt1C/EFLlPDrtxqs9hYmYkWZGAv5i+2ty7Au2FRrojlLyw/4jlLanWeaE8buUpkjuCfnfflnxuTT4jloM+ONcZ3KcAWINXVAMwgMkFY0+xsWxpRLc0u411f9oAWbUd7YTiPL/zb35apHmmiQDnm2uY3dgLMC8y40hfq3rGItxFxqyw+0pnD9WVSirDAkoDnIBN2fBCoufStAC2j1WgBdGQo14hn8CIJr0NPK0S1oI3B0fHKOCdgvoaUg1z1H9ZvUX43VQZ/hOMmREVM06E4YyGG+Xz3Vsc6ScDfE6LTxzdkwBQo79o8AKfzBsysvJPWlbgKuZn4rw4IUaX5xQeD2y8tgv1zFyG9GHdJUG0MF0qFKay7HewHXUglso02DaAKLkZMGPg7W8XCXYEGWwTIZHeFQi2TpIc42TCXyVIAZGqP/QqJLaHr+LUqCethfUoH+16znse1Cyfzho7iXQ03IQ3oNgyEtoobZbJqz3aO2casr9QcoESD9HcSKHKJmNKhoyD+MZapyQaiirmQISNAyqFz8wmr9645YWtF6xKWmEE3azKs827YrL0SRT/HZntHf8pNd/tOec3TPMiJmImQ5bb0/1lOnILwoKfnCR+4COHyMJUQ="

branches:
  only:
    - master

before_script:
  - docker pull "$IMAGE_NAME" || true

script:
  - docker build --pull --cache-from "$IMAGE_NAME" --tag "$IMAGE_NAME" .

after_script:
  - docker images

before_deploy:
  - docker login -u "$DOCKER_USER" -p "$DOCKER_PASSWORD"
  - docker tag "$IMAGE_NAME" "${IMAGE_NAME}:latest"
  - docker tag "$IMAGE_NAME" "${IMAGE_NAME}:${TRAVIS_BUILD_NUMBER}"

deploy:
  provider: script
  script: docker push "${IMAGE_NAME}:latest" && docker push "${IMAGE_NAME}:${TRAVIS_BUILD_NUMBER}"
  on:
    branch: master